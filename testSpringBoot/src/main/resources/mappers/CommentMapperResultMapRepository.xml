<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="testSpringBoot.mapper.CommentMapperDynamic">

<resultMap type="testSpringBoot.domain.ReplyDTO" id="replyBaseMap">
		<id column="comment_no" jdbcType="BIGINT" property="commentNo"/>
		<id column="cuser_id" jdbcType="VARCHAR" property="cuserId"/>
		<id column="reply_no" jdbcType="BIGINT" property="replyNo"/>
		<id column="ruser_id" jdbcType="VARCHAR" property="ruserId"/>
		<result column="reply_content" jdbcType="VARCHAR" property="replyContent"/>
		<result column="CREG_DATE" jdbcType="TIMESTAMP" property="regDate"/>
</resultMap>

<resultMap type="testSpringBoot.domain.CommentDTO" id="commentMap">
	<id column="comment_no" jdbcType="BIGINT" property="commentNo"/>
	<id column="cuser_id" jdbcType="VARCHAR" property="cuserId"/>
	<result column="RREG_DATE" jdbcType="TIMESTAMP" property="regDate"/>
	<result column="comment_subject" jdbcType="VARCHAR" property="commentSubject"/>
	<result column="comment_content" jdbcType="VARCHAR" property="commentContent"/>
</resultMap>

<resultMap type="testSpringBoot.domain.CommentRepliesDTO" id="collectionResultMap">
	<association property="commentDTO" javaType="testSpringBoot.domain.CommentDTO" resultMap="commentMap" />
	<collection property="replies" ofType="testSpringBoot.domain.ReplyDTO" resultMap="replyBaseMap" />
</resultMap>

<select id="commentRepliesCollection" resultMap="collectionResultMap" 
			parameterType="long">
	select 
		c.COMMENT_NO,c.CUSER_ID,COMMENT_SUBJECT,COMMENT_CONTENT,c.REG_DATE CREG_DATE,
	    reply_no, ruser_id, reply_content, r.reg_Date RREG_DATE
	from comment1 c left outer join reply r
	on	c.comment_no = r.comment_no
	<trim prefix="where" prefixOverrides="AND | OR">
		<if test="value != null">
			and c.comment_no = #{commentNo}
		</if>
	</trim>
</select>

</mapper>